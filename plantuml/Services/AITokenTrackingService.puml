@startuml
class AITokenTrackingService {
    + AITokenTrackingService(dbContextFactory:IDbContextFactory<ApplicationDbContext>, configuration:IConfiguration)
    + <<async>> TrackChatCompletionUsageAsync(completion:ChatCompletion, operation:string, userId:string?, additionalDetails:string?, requestDuration:TimeSpan?) : Task
    + <<async>> TrackFailedRequestAsync(operation:string, errorMessage:string, userId:string?, requestDuration:TimeSpan?) : Task
    + <<async>> GetUsageStatsAsync(since:DateTime?) : Task<TokenUsageStats>
}
class TokenUsageStats {
    + TotalTokens : int <<get>> <<set>>
    + TotalPromptTokens : int <<get>> <<set>>
    + TotalCompletionTokens : int <<get>> <<set>>
    + TotalCost : decimal <<get>> <<set>>
    + RequestCount : int <<get>> <<set>>
    + SuccessfulRequests : int <<get>> <<set>>
    + FailedRequests : int <<get>> <<set>>
    + AverageTokensPerRequest : double <<get>> <<set>>
    + MostUsedOperation : string <<get>> <<set>>
}
@enduml
