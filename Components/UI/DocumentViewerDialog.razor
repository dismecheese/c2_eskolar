@using MudBlazor
@inject IDialogService DialogService
@inject Microsoft.Extensions.Logging.ILogger<DocumentViewerDialog> Logger

@code {
    [Parameter] public string Title { get; set; } = "";
    [Parameter] public string DocumentType { get; set; } = "";
    [Parameter] public string DocumentUrl { get; set; } = "";
    [Parameter] public string Error { get; set; } = "";
    [Parameter] public bool Loading { get; set; } = false;
    
    [CascadingParameter] MudDialogInstance MudDialog { get; set; } = default!;

    protected override void OnInitialized()
    {
        Logger?.LogInformation("=== DOCUMENT VIEWER DIALOG INITIALIZED ===");
        Logger?.LogInformation("Title: {Title}", Title);
        Logger?.LogInformation("DocumentType: {DocumentType}", DocumentType);
        Logger?.LogInformation("DocumentUrl: {DocumentUrl}", DocumentUrl);
        Logger?.LogInformation("Error: {Error}", Error);
        Logger?.LogInformation("Loading: {Loading}", Loading);
        Logger?.LogInformation("MudDialog instance: {MudDialog}", MudDialog != null);
    }

    private void Close()
    {
        Logger?.LogInformation("Closing dialog");
        MudDialog?.Close();
    }
}

<MudDialog>
    <DialogContent>
        <MudStack Spacing="2">
            <MudText Typo="Typo.h5" Color="Color.Primary">
                <MudIcon Icon="@Icons.Material.Filled.Description" Class="me-2" />@Title
            </MudText>
            @if (Loading)
            {
                <MudProgressCircular Color="Color.Primary" Size="Size.Large" Class="my-4 mx-auto" />
                <MudText Typo="Typo.body1" Align="Align.Center">Loading document...</MudText>
            }
            else if (!string.IsNullOrEmpty(Error))
            {
                <MudAlert Severity="Severity.Error" Variant="Variant.Filled" Elevation="1" Class="my-4">
                    <MudIcon Icon="@Icons.Material.Filled.Error" Class="me-2" />@Error
                </MudAlert>
            }
            else if (!string.IsNullOrEmpty(DocumentUrl))
            {
                @if (DocumentType == "PDF")
                {
                    <iframe src="@DocumentUrl" style="width:100%;height:70vh;border:none;background:#f8f9fa;" title="PDF Document"></iframe>
                }
                else if (DocumentType == "Image")
                {
                    <img src="@DocumentUrl" alt="Document Image" style="max-width:100%;max-height:70vh;object-fit:contain;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,0.1);margin:auto;display:block;" />
                }
                else
                {
                    <MudAlert Severity="Severity.Warning" Variant="Variant.Filled" Elevation="1" Class="my-4">
                        <MudIcon Icon="@Icons.Material.Filled.Warning" Class="me-2" />This document cannot be previewed in the browser. You can download it directly.
                    </MudAlert>
                }
            }
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="Close">
            <MudIcon Icon="@Icons.Material.Filled.Close" Class="me-1" />Close
        </MudButton>
        @if (!string.IsNullOrEmpty(DocumentUrl))
        {
            <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="@DocumentUrl" Target="_blank">
                <MudIcon Icon="@Icons.Material.Filled.Download" Class="me-1" />Download
            </MudButton>
            <MudButton Variant="Variant.Filled" Color="Color.Info" Href="@DocumentUrl" Target="_blank">
                <MudIcon Icon="@Icons.Material.Filled.OpenInNew" Class="me-1" />Open in New Tab
            </MudButton>
        }
    </DialogActions>
</MudDialog>
