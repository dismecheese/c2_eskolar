@page "/faqs"

@using System.Linq
@using Microsoft.AspNetCore.Identity
@using c2_eskolar.Components.UI
@inject IJSRuntime JSRuntime
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject UserManager<IdentityUser> UserManager

<PageTitle>FAQs</PageTitle>

<div class="faq-container">

<!-- Left section with title, description, and contact block -->
    <div class="faq-left">
        <h1 class="faq-title">Frequently Asked Questions</h1>
        <div class="faq-desc">Find answers to common questions about eSkolar, scholarships, and more.</div>
        <div class="faq-contact-block">
            <div class="faq-contact-label">Canâ€™t find what you are looking for?</div>
            <div class="faq-contact-desc">We would like to chat with you.</div>
            <button type="button" class="faq-contact-img-link" title="Chat with AI Assistant" @onclick="OpenChatbot" style="background: none; border: none; padding: 0; cursor: pointer;">
                <img src="/images/main/eskolar_logo.png" alt="eSkolar Chat" class="faq-contact-img" />
            </button>
        </div>
    </div>

    <!-- Right section with FAQ accordion -->
    <div class="faq-right">
        <div class="accordion accordion-flush faq-accordion" id="faqAccordionFlush">
            @foreach (var faq in faqs)
            {
                <div class="accordion-item">
                    <h2 class="accordion-header" id="@faq.HeadingId">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#@faq.CollapseId" aria-expanded="false" aria-controls="@faq.CollapseId">
                            <span>@faq.Question</span>
                            <span class="faq-v-icon">
                                <svg width="28" height="28" viewBox="0 0 28 28">
                                    <polyline points="7 11 14 18 21 11" fill="none" stroke="#181818" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                        </button>
                    </h2>
                    <!-- Collapsible answer body -->
                    <div id="@faq.CollapseId" class="accordion-collapse collapse" aria-labelledby="@faq.HeadingId" data-bs-parent="#faqAccordionFlush">
                        <div class="accordion-body">
                            @faq.Answer
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<!-- Help Box Button (opens chatbot) -->
<button class="help-box-bottom" @onclick="OpenChatbot" type="button">
    <div class="help-box-content">
        <img src="images/NeedHelp.svg" alt="Help" class="help-box-img" />
        <div class="help-box-text">
            <div class="help-box-title">Need help?</div>
            <div class="help-box-desc">Having trouble with FAQs?<br />Ask our AI assistant!</div>
        </div>
    </div>
</button>

<!-- Floating Chatbot Window -->
@if (ShowChatbot)
{
    <ChatBot CloseChatbot="CloseChatbot" MinimizeChatbot="MinimizeChatbot" 
             CurrentPage="FAQs" 
             CurrentSection="Frequently Asked Questions"
             PageData="@(new Dictionary<string, object> { ["totalFaqs"] = faqs.Count, ["pageType"] = "FAQ" })"
             VisibleItems="@(faqs.Cast<object>().ToList())" />
}

@code {
    // Chatbot state
    private bool ShowChatbot = false;
    
    private void OpenChatbot() => ShowChatbot = true;
    private void CloseChatbot() => ShowChatbot = false;
    private void MinimizeChatbot() => ShowChatbot = false;

    // FAQ items list
    private List<FaqItem> faqs = new()
    {
        new FaqItem("What is eSkolar?", "eSkolar is a centralized, AI-driven web platform that connects students, institutions, and benefactors for academic opportunities. It streamlines scholarship application, monitoring, and management for all stakeholders.", "flush-headingOne", "flush-collapseOne"),
        new FaqItem("Who can use eSkolar?", "Students, educational institutions, benefactors (organizations, companies, foundations), and even parents or guardians (with limited access) can use eSkolar.", "flush-headingTwo", "flush-collapseTwo"),
        new FaqItem("What are the minimum device requirements?", "Any web-enabled device such as a desktop, laptop, tablet, or smartphone with a modern browser (Chrome, Firefox, Edge, Safari) and a stable internet connection.", "flush-headingThree", "flush-collapseThree"),
        new FaqItem("How does eSkolar protect my data?", "eSkolar uses HTTPS encryption, AES encryption at rest, role-based access control, multi-factor authentication, and follows the Data Privacy Act of 2012 (RA 10173).", "flush-headingFour", "flush-collapseFour"),
        new FaqItem("How do I apply for a scholarship?", "Register as a student, complete your profile, browse available scholarships, and follow the application instructions for each scholarship. Some may require document uploads or external applications.", "flush-headingFive", "flush-collapseFive"),
        new FaqItem("What is the difference between a Benefactor and an Institution?", "Benefactors are organizations or foundations that provide scholarships. Institutions are schools or universities that manage and monitor scholarships and scholars.", "flush-headingSix", "flush-collapseSix"),
        new FaqItem("What browsers are supported?", "eSkolar supports Chrome, Firefox, Edge, and Safari on desktop and mobile devices.", "flush-headingSeven", "flush-collapseSeven"),
        new FaqItem("Is there a mobile app?", "Not yet. eSkolar is fully responsive and works on all modern browsers and devices.", "flush-headingEight", "flush-collapseEight"),
        new FaqItem("How do I become a partner?", "Institutions and benefactors can contact us through the Contact page to discuss partnership opportunities.", "flush-headingNine", "flush-collapseNine"),
        new FaqItem("Who do I contact for support?", "For support, email us at <b>eskolarph@gmail.com</b> or use the Contact Us page.", "flush-headingTen", "flush-collapseTen"),
    };

    // FAQ item model
    public class FaqItem
    {
        public string Question { get; }
        public string Answer { get; }
        public string HeadingId { get; }
        public string CollapseId { get; }
        public FaqItem(string q, string a, string headingId, string collapseId)
        {
            Question = q;
            Answer = a;
            HeadingId = headingId;
            CollapseId = collapseId;
        }
    }
}

