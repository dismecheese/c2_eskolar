@page "/dashboard/benefactor"
@attribute [Authorize(Roles = "Benefactor")]
@layout Layout.BenefactorDashLayout
@inject NavigationManager Navigation

<PageTitle>Benefactors Dashboard</PageTitle>

<style>
    .text-decoration-none {
        text-decoration: none !important;
    }
</style>

<div class="dashboard-center-container">
    <!-- Top Bar -->
    <div class="dashboard-topbar">
        <input class="university-input" type="text" placeholder="University Name:" />
        <span class="dashboard-date">@DateTime.Now.ToString("dd MMM yyyy, ddd")</span>
    </div>

    <!-- Welcome Banner -->
    <div class="dashboard-banner-centered">
        <div class="banner-text">
            <h2>Welcome, Ralph!</h2>
        </div>
        <img src="images/eskolar_books.svg" alt="Books" class="banner-img" />
    </div>

    <!-- Yellow Tabs -->
    <div class="dashboard-tabs">
        <button class="dashboard-tab @(activeTab == 0 ? "active" : "")" @onclick="() => SetTab(0)">Recently Viewed</button>
        <a class="dashboard-tab text-decoration-none" href="/dashboard/institution/scholars">View Scholars</a>
    </div>

    @if (showScholarshipList)
    {
        <!-- Scholarship List Page (matches your screenshot) -->
        <div style="background:#fff;padding:32px 0;">
            <div style="max-width:1100px;margin:0 auto;">
                <input type="text" placeholder="Search" style="width:400px;padding:12px 16px;border-radius:8px;border:1.5px solid #d1d5db;margin-bottom:24px;"/>
                <div style="display:flex;gap:8px;margin-bottom:18px;">
                    <button class="scholarship-list-tab @(scholarshipTab == 0 ? "active" : "")" @onclick="() => SetScholarshipTab(0)">Institutional</button>
                    <button class="scholarship-list-tab @(scholarshipTab == 1 ? "active" : "")" @onclick="() => SetScholarshipTab(1)">Open</button>
                    <button class="scholarship-list-tab @(scholarshipTab == 2 ? "active" : "")" @onclick="() => SetScholarshipTab(2)">All</button>
                    <button class="scholarship-list-tab @(scholarshipTab == 3 ? "active" : "")" @onclick="() => SetScholarshipTab(3)">Recommended</button>
                </div>
                <div style="display:flex;gap:12px;justify-content:flex-end;margin-bottom:18px;">
                    <select style="padding:6px 16px;border-radius:6px;border:1.5px solid #e0e0e0;">
                        <option>Filter</option>
                    </select>
                    <select style="padding:6px 16px;border-radius:6px;border:1.5px solid #e0e0e0;">
                        <option>Sort</option>
                    </select>
                </div>
                @if (scholarshipTab == 0)
                {
                    <div style="margin-top:100px;text-align:center;font-size:1.18rem;font-family:'Inter',sans-serif;">
                        Institutional scholarships will be available here once your school joins our platform.<br />
                        Suggest your school to join eSkolar!
                    </div>
                }
                else
                {
                    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:32px;">
                        @for (int i = 0; i < 9; i++)
                        {
                            <a href="/dashboard/institution/scholarships-info" class="scholarship-card text-decoration-none" style="height:140px;cursor:pointer;display:block;">
                                <div class="scholarship-card-img" style="width:70px;height:70px;margin-bottom:12px;background:#eee;display:flex;align-items:center;justify-content:center;">
                                    <svg width="48" height="48" viewBox="0 0 48 48">
                                        <rect x="4" y="4" width="40" height="40" fill="#fff" stroke="#bbb" stroke-width="2"/>
                                        <line x1="14" y1="14" x2="34" y2="34" stroke="#bbb" stroke-width="2"/>
                                        <line x1="14" y1="34" x2="34" y2="14" stroke="#bbb" stroke-width="2"/>
                                    </svg>
                                </div>
                                <div class="scholarship-card-title">Scholarship Name</div>
                            </a>
                        }
                    </div>
                }
            </div>
            <div style="text-align:center;margin-top:32px;">
                <button class="dashboard-tab" style="width:auto;padding:8px 32px;" @onclick="BackToDashboard">Back</button>
            </div>
        </div>
    }
    else if (activeTab == -1)
    {
        <!-- Sectioned Layout (default view) -->
        <div class="scholarship-section">
            <div class="scholarship-row">
                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <button class="scholarship-row-title scholarship-row-title-btn"
                            @onclick="() => ShowScholarshipList(0)">
                        Institutional Scholarships <span>&gt;</span>
                    </button>
                </div>
                <div class="scholarship-cards">
                    @for (int i = 0; i < 3; i++)
                    {
                        <a href="/dashboard/institution/scholarships-info" class="scholarship-card text-decoration-none">
                            <div class="scholarship-card-img"></div>
                            <div class="scholarship-card-title">Scholarship Name</div>
                        </a>
                    }
                </div>
            </div>
            <div class="scholarship-row">
                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <button class="scholarship-row-title scholarship-row-title-btn"
                            @onclick="() => ShowScholarshipList(1)">
                        Open Scholarships <span>&gt;</span>
                    </button>
                </div>
                <div class="scholarship-cards">
                    @for (int i = 0; i < 3; i++)
                    {
                        <a href="/dashboard/institution/scholarships-info" class="scholarship-card text-decoration-none">
                            <div class="scholarship-card-img"></div>
                            <div class="scholarship-card-title">Scholarship Name</div>
                        </a>
                    }
                </div>
            </div>
            <div class="scholarship-row">
                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <button class="scholarship-row-title scholarship-row-title-btn"
                            @onclick="() => ShowScholarshipList(3)">
                        Recommended Scholarships <span>&gt;</span>
                    </button>
                </div>
                <div class="scholarship-cards">
                    @for (int i = 0; i < 3; i++)
                    {
                        <a href="/dashboard/institution/scholarships-info" class="scholarship-card text-decoration-none">
                            <div class="scholarship-card-img"></div>
                            <div class="scholarship-card-title">Scholarship Name</div>
                        </a>
                    }
                </div>
            </div>
        </div>
    }
    else if (activeTab == 0)
    {
        <!-- Recently Viewed Scholarships Tab (separate layout) -->
        <div class="scholarship-section">
            <div style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 8px;">
                <button class="clear-link" style="background:none;border:none;color:#bbb;font-weight:500;font-size:16px;">Clear</button>
            </div>
            <div class="scholarship-cards" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 32px;">
                @for (int i = 0; i < 9; i++)
                {
                    <div class="scholarship-card" style="position:relative;">
                        <span style="position:absolute;top:10px;right:16px;font-size:18px;color:#bbb;cursor:pointer;">&times;</span>
                        <div class="scholarship-card-img" style="display:flex;align-items:center;justify-content:center;">
                            <svg width="60" height="60" viewBox="0 0 60 60">
                                <rect x="5" y="5" width="50" height="50" fill="#eee" stroke="#bbb" stroke-width="2"/>
                                <line x1="15" y1="15" x2="45" y2="45" stroke="#bbb" stroke-width="2"/>
                                <line x1="15" y1="45" x2="45" y2="15" stroke="#bbb" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="scholarship-card-title" style="text-align:center;">Scholarship Name</div>
                    </div>
                }
            </div>
        </div>
    }
    else if (activeTab == 1)
    {
        <!-- Current Applications Content -->
        <div class="scholarship-section">
            <div class="scholarship-cards">
                @for (int i = 0; i < 9; i++)
                {
                    <div class="scholarship-card" style="position:relative;">
                        <span style="position:absolute;top:8px;right:12px;font-size:18px;color:#bbb;cursor:pointer;">&times;</span>
                        <div class="scholarship-card-img"></div>
                        <div class="scholarship-card-title">Scholarship Name</div>
                        <div class="scholarship-card-status">@((i % 2 == 0) ? "Pending" : "Applied")</div>
                    </div>
                }
            </div>
        </div>
    }
    else if (activeTab == 2)
    {
        <!-- My Scholarships Content -->
        <div class="scholarship-section">
            <div class="scholarship-cards" style="flex-direction:column;gap:24px;">
                @for (int i = 0; i < 4; i++)
                {
                    <div class="scholarship-card" style="width: 90%; max-width: 600px; margin: 0 auto; flex-direction: row; align-items: center; height: 80px;">
                        <div class="scholarship-card-img" style="margin-bottom:0;margin-right:16px;"></div>
                        <div class="scholarship-card-title" style="flex:1;text-align:left;">Scholarship Name</div>
                        <div class="scholarship-card-status" style="position:static;right:unset;top:unset;">
                            @(i == 0 || i == 1 ? "Active" : i == 2 ? "Completed" : "Suspended")
                        </div>
                    </div>
                }
            </div>
        </div>
    }
</div>


<!-- Profile Pop-out Component -->
<div class="profile-popout">
    <button class="profile-popout-close" aria-label="Close" @onclick="CloseProfilePopout">&#10005;</button>
    <div class="profile-popout-avatar" style="margin-top:32px;">
        <svg width="110" height="110" viewBox="0 0 110 110">
            <circle cx="55" cy="55" r="54" fill="#fff" stroke="#222" stroke-width="4"/>
            <circle cx="55" cy="45" r="28" fill="#222"/>
            <ellipse cx="55" cy="90" rx="36" ry="18" fill="#222"/>
        </svg>
    </div>
    <div class="profile-popout-name" style="font-size:1.18rem;font-weight:700;margin-bottom:2px;text-align:center;">Ralph Marilao</div>
    <div class="profile-popout-position" style="font-size:1rem;color:#666;margin-bottom:18px;text-align:center;">Position</div>
    <button class="profile-popout-profile-btn" style="background:#888;border:none;border-radius:18px;padding:6px 32px;font-weight:600;color:#fff;cursor:pointer;">Profile</button>
</div>

@code {
    private int activeTab = -1;
    private bool showScholarshipList = false;
    private int scholarshipTab = 0; // 0: Institutional, 1: Open, 2: All, 3: Recommended

    protected override void OnInitialized()
    {
        var uri = Navigation.ToAbsoluteUri(Navigation.Uri);
        var query = QueryHelpers.ParseQuery(uri.Query);
        if (query.TryGetValue("tab", out var tabValue) && int.TryParse(tabValue, out var tabIndex))
        {
            activeTab = tabIndex;
        }
    }

    private void SetTab(int tab)
    {
        activeTab = tab;
        showScholarshipList = false;
        StateHasChanged();
    }

    private void ShowScholarshipList(int tab)
    {
        showScholarshipList = true;
        scholarshipTab = tab;
    }

    private void SetScholarshipTab(int tab)
    {
        scholarshipTab = tab;
    }

    private void BackToDashboard()
    {
        showScholarshipList = false;
    }

    private void ClearRecentlyViewed()
    {
        // Add logic to clear recently viewed scholarships if needed
    }

    private void CloseProfilePopout()
    {
        // Add logic to close profile popout if needed
        StateHasChanged();
    }
}

